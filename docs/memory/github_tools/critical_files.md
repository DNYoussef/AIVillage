# Critical Files for GitHub Integration

## Required Files & Directory Structure

### GitHub Workflows Directory
```
.github/
└── workflows/
    ├── security-scan.yml
    ├── architectural-quality.yml
    ├── tests.yml
    ├── build.yml
    └── deploy.yml
```

### Security Infrastructure
```
security/
├── reports/          # Required for security workflows
│   ├── pip-audit.json
│   ├── safety-report.json
│   ├── bandit-report.json
│   └── semgrep-report.json
├── sboms/           # Software Bill of Materials
│   ├── requirements-sbom.json
│   └── full-sbom.json
└── policies/        # Optional security policies
    └── security-policy.yml
```

### Configuration Files

#### `.secrets.baseline`
**Purpose**: Secrets detection baseline for detect-secrets tool
**Required for**: Security workflows
**Content**:
```json
{
  "version": "1.4.0",
  "plugins_used": [
    {
      "name": "ArtifactoryDetector"
    },
    {
      "name": "AWSKeyDetector"
    },
    {
      "name": "Base64HighEntropyString",
      "limit": 4.5
    },
    {
      "name": "BasicAuthDetector"
    },
    {
      "name": "CloudantDetector"
    },
    {
      "name": "HexHighEntropyString",
      "limit": 3.0
    },
    {
      "name": "JwtTokenDetector"
    },
    {
      "name": "KeywordDetector",
      "keyword_exclude": ""
    },
    {
      "name": "MailchimpDetector"
    },
    {
      "name": "PrivateKeyDetector"
    },
    {
      "name": "SlackDetector"
    },
    {
      "name": "SoftlayerDetector"
    },
    {
      "name": "StripeDetector"
    },
    {
      "name": "TwilioKeyDetector"
    }
  ],
  "filters_used": [
    {
      "path": "detect_secrets.filters.allowlist.is_line_allowlisted"
    },
    {
      "path": "detect_secrets.filters.common.is_baseline_file"
    },
    {
      "path": "detect_secrets.filters.common.is_ignored_due_to_verification_policies",
      "min_level": 2
    },
    {
      "path": "detect_secrets.filters.heuristic.is_indirect_reference"
    },
    {
      "path": "detect_secrets.filters.heuristic.is_likely_id_string"
    },
    {
      "path": "detect_secrets.filters.heuristic.is_lock_file"
    },
    {
      "path": "detect_secrets.filters.heuristic.is_not_alphanumeric_string"
    },
    {
      "path": "detect_secrets.filters.heuristic.is_potential_uuid"
    },
    {
      "path": "detect_secrets.filters.heuristic.is_prefixed_with_dollar_sign"
    },
    {
      "path": "detect_secrets.filters.heuristic.is_sequential_string"
    },
    {
      "path": "detect_secrets.filters.heuristic.is_swagger_file"
    },
    {
      "path": "detect_secrets.filters.heuristic.is_templated_secret"
    }
  ],
  "results": {},
  "generated_at": "2024-01-01T00:00:00Z"
}
```

#### `pyproject.toml`
**Purpose**: Python project configuration and tool settings
**Required for**: Python-based workflows, security tools, linting
**Critical sections**:
```toml
[project]
name = "aivillage"
version = "0.1.0"
description = "AI Village Infrastructure"
dependencies = [
    "fastapi",
    "pydantic",
    "sqlalchemy",
    # ... other dependencies
]

[tool.bandit]
exclude_dirs = ["tests"]
skips = ["B101", "B601"]

[tool.safety]
ignore = []

[tool.ruff]
line-length = 88
select = ["E", "F", "I", "UP", "C90", "N", "ARG", "SIM", "RET"]

[tool.ruff.mccabe]
max-complexity = 10

[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"
```

### Scripts Directory
```
scripts/
├── ci/
│   ├── quality-gate.py       # Quality assessment
│   ├── security-check.py     # Security validation
│   └── deployment-check.py   # Deployment readiness
├── architectural_analysis.py  # Architecture analysis
├── coupling_metrics.py       # Coupling analysis  
├── detect_anti_patterns.py   # Anti-pattern detection
└── performance_benchmark.py  # Performance analysis
```

#### Key Script Requirements

**`scripts/architectural_analysis.py`**
- Must accept: `--project-root .` and `--output-format json`
- Output format: JSON with architectural metrics
- Exit codes: 0 for success, 1 for warnings, 2 for errors

**`scripts/coupling_metrics.py`** 
- Must accept: `--format json`
- Output format: JSON with coupling measurements
- Should generate: `coupling_report.json`

**`scripts/detect_anti_patterns.py`**
- Must accept: `--project-root .` and `--format json`
- Output format: JSON with anti-pattern detections
- Should generate: `antipatterns_report.json`

### Output Files (Generated)
```
# Generated by workflows - should be in .gitignore
coupling_report.json
antipatterns_report.json
architectural_report.json
performance_baseline.json
security/reports/*.json
security/sboms/*.json
```

### Requirements Files
```
requirements/
├── base.txt          # Core dependencies
├── development.txt   # Development tools
├── security.txt      # Security tools
└── testing.txt       # Testing frameworks
```

**`requirements/security.txt`**
```
bandit>=1.7.0
safety>=2.0.0
semgrep>=1.0.0
cyclonedx-bom>=3.0.0
detect-secrets>=1.4.0
pip-audit>=2.0.0
```

## File Creation Patterns

### Pattern 1: Initialize Security Infrastructure
```bash
# Create directory structure
mkdir -p security/{reports,sboms,policies}

# Initialize secrets baseline
echo '{"version": "1.4.0", "plugins_used": [], "filters_used": [], "results": {}, "generated_at": "'$(date -Iseconds)'"}' > .secrets.baseline

# Create gitignore entries
cat >> .gitignore << 'EOF'
# Security reports
security/reports/*.json
security/sboms/*.json
coupling_report.json
antipatterns_report.json
EOF
```

### Pattern 2: Script Template Creation
```python
# Template for analysis scripts
#!/usr/bin/env python3
"""
Template for CI analysis scripts
Must support: --project-root, --output-format/--format, proper exit codes
"""
import argparse
import json
import sys
from pathlib import Path

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('--project-root', default='.', help='Project root directory')
    parser.add_argument('--output-format', '--format', default='json', help='Output format')
    args = parser.parse_args()
    
    try:
        # Analysis logic here
        results = {"status": "success", "metrics": {}}
        
        if args.output_format == 'json':
            print(json.dumps(results, indent=2))
        else:
            print("Analysis completed successfully")
            
        return 0
    except Exception as e:
        print(f"Error: {e}", file=sys.stderr)
        return 1

if __name__ == "__main__":
    sys.exit(main())
```

### Pattern 3: Workflow Dependencies Check
```yaml
# Common workflow dependency check pattern
- name: Check dependencies
  run: |
    # Check for required directories
    mkdir -p security/reports security/sboms
    
    # Check for required files
    test -f .secrets.baseline || echo '{}' > .secrets.baseline
    test -f pyproject.toml || echo '[project]\nname = "project"' > pyproject.toml
    
    # Verify scripts exist and are executable
    test -x scripts/architectural_analysis.py || chmod +x scripts/architectural_analysis.py
```

## File Validation Commands

### Check Required Structure
```bash
# Validate directory structure
find .github/workflows -name "*.yml" | wc -l  # Should be > 0
test -d security/reports || echo "Missing security/reports"
test -d security/sboms || echo "Missing security/sboms"

# Validate configuration files
test -f .secrets.baseline || echo "Missing .secrets.baseline"
test -f pyproject.toml || echo "Missing pyproject.toml"
python -c "import tomllib; tomllib.load(open('pyproject.toml', 'rb'))" 2>/dev/null || echo "Invalid pyproject.toml"

# Validate scripts
python scripts/architectural_analysis.py --help >/dev/null 2>&1 || echo "architectural_analysis.py not working"
python scripts/coupling_metrics.py --help >/dev/null 2>&1 || echo "coupling_metrics.py not working"
```

### Quick Setup Command
```bash
# One-command setup for GitHub integration
setup_github_integration() {
    mkdir -p security/{reports,sboms} scripts/ci
    echo '{"version": "1.4.0", "plugins_used": [], "results": {}}' > .secrets.baseline
    touch scripts/{architectural_analysis.py,coupling_metrics.py,detect_anti_patterns.py}
    chmod +x scripts/*.py
    echo "GitHub integration files created"
}
```

## Integration with Claude Code

### File Creation Workflow
```javascript
[GitHubIntegrationSetup]:
  // Check current structure
  Bash("find .github security scripts -type f 2>/dev/null | head -20")
  
  // Create required directories
  Bash("mkdir -p security/{reports,sboms} scripts/ci")
  
  // Create configuration files
  Write(".secrets.baseline")
  Write("pyproject.toml") 
  
  // Create script templates
  Write("scripts/architectural_analysis.py")
  Write("scripts/coupling_metrics.py")
  Write("scripts/detect_anti_patterns.py")
  
  // Make scripts executable
  Bash("chmod +x scripts/*.py")
  
  // Validate setup
  Bash("python scripts/architectural_analysis.py --help || echo 'Script needs implementation'")
```

## Common File Issues & Solutions

### Issue 1: Missing Configuration Files
**Symptoms**: Workflow fails with "file not found"
**Solution**: Create minimal configuration files with required structure

### Issue 2: Script Parameter Mismatches  
**Symptoms**: "Unknown argument" errors in workflows
**Solution**: Standardize script interfaces with --help support

### Issue 3: Permission Issues
**Symptoms**: "Permission denied" when executing scripts
**Solution**: `chmod +x scripts/*.py` and verify shebang lines

### Issue 4: Invalid File Formats
**Symptoms**: JSON parsing errors, YAML syntax errors
**Solution**: Validate files with appropriate parsers before committing