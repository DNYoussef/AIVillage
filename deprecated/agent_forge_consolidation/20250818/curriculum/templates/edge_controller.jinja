# Edge Controller System

You are an expert curriculum controller maintaining optimal difficulty levels for productive struggle.

## Task
Analyze current performance and adjust the edge-of-chaos window to maintain target accuracy range (55-75%).

## Current State
- **Window Accuracy**: {{ "%.1%"|format(window_accuracy) }}
- **Current Edge**: {{ "%.2f"|format(current_edge.low) }} - {{ "%.2f"|format(current_edge.high) }}
- **Target Range**: {{ "%.1%"|format(constraints.target_low) }} - {{ "%.1%"|format(constraints.target_high) }}

## Performance Analysis

### Accuracy Assessment:
{% if window_accuracy < constraints.target_low %}
ðŸ”´ **Below Target**: {{ "%.1%"|format(window_accuracy) }} < {{ "%.1%"|format(constraints.target_low) }}
- Problems are too difficult
- Students struggling more than optimal
- Need to reduce difficulty
{% elif window_accuracy > constraints.target_high %}
ðŸ”µ **Above Target**: {{ "%.1%"|format(window_accuracy) }} > {{ "%.1%"|format(constraints.target_high) }}
- Problems are too easy
- Students not sufficiently challenged
- Need to increase difficulty
{% else %}
ðŸŸ¢ **In Target Range**: {{ "%.1%"|format(constraints.target_low) }} â‰¤ {{ "%.1%"|format(window_accuracy) }} â‰¤ {{ "%.1%"|format(constraints.target_high) }}
- Optimal productive struggle zone
- Minor adjustments may still help
{% endif %}

## Edge Nudging Strategy

### Adjustment Principles:
- **Conservative**: Small incremental changes (0.05-0.15 range)
- **Symmetric**: Adjust both low and high bounds proportionally
- **Bounded**: Keep within reasonable difficulty limits (0.1-0.9)
- **Responsive**: Larger adjustments for bigger accuracy deviations

### Nudge Calculations:
- **Accuracy Gap**: {{ "%.3f"|format(window_accuracy - (constraints.target_low + constraints.target_high) / 2) }}
- **Suggested Nudge**:
  {% if window_accuracy < constraints.target_low %}
  Decrease difficulty by {{ "%.3f"|format((constraints.target_low - window_accuracy) * 0.5) }}
  {% elif window_accuracy > constraints.target_high %}
  Increase difficulty by {{ "%.3f"|format((window_accuracy - constraints.target_high) * 0.5) }}
  {% else %}
  Fine-tune within current range
  {% endif %}

### Edge Window Constraints:
- **Minimum Width**: 0.15 (ensure sufficient problem variety)
- **Maximum Width**: 0.35 (maintain focus)
- **Lower Bound**: â‰¥0.10 (avoid trivial problems)
- **Upper Bound**: â‰¤0.90 (avoid impossible problems)

## Controller Action

Calculate new edge window that:
1. Moves accuracy toward target range center
2. Maintains reasonable window width
3. Respects absolute bounds
4. Makes conservative adjustments

Respond with ONLY valid JSON matching this exact structure:

```json
{
  "ok": true,
  "msg": "nudged",
  "new_edge": {
    "low": 0.50,
    "high": 0.70
  },
  "delta": {
    "low": -0.05,
    "high": -0.05
  }
}
```
