<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Forge Developer UI</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .service-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .service-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status-healthy { color: #27ae60; }
        .status-unhealthy { color: #e74c3c; }
        .status-unknown { color: #f39c12; }
        .button { background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; margin: 5px; }
        .button:hover { background: #2980b9; }
        .button.danger { background: #e74c3c; }
        .button.danger:hover { background: #c0392b; }
        .log { background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 4px; font-family: monospace; max-height: 300px; overflow-y: auto; margin: 10px 0; }
        .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 10px 0; }
        .metric { background: #ecf0f1; padding: 10px; border-radius: 4px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Agent Forge Developer UI</h1>
            <p>Integrated development environment for Agent Forge model training and testing</p>
        </div>

        <div class="service-grid">
            <div class="service-card">
                <h3>Service Status</h3>
                <div id="service-status">Loading...</div>
                <button class="button" onclick="refreshStatus()">Refresh Status</button>
                <button class="button" onclick="runTests()">Run Integration Tests</button>
            </div>

            <div class="service-card">
                <h3>System Metrics</h3>
                <div id="system-metrics" class="metrics">Loading...</div>
            </div>

            <div class="service-card">
                <h3>Quick Actions</h3>
                <a href="http://localhost:8083/docs" class="button" target="_blank">Agent Forge API</a>
                <a href="http://localhost:8084/docs" class="button" target="_blank">Model Chat API</a>
                <a href="http://localhost:8085/docs" class="button" target="_blank">WebSocket API</a>
                <button class="button" onclick="startCognatePhase()">Start Cognate Phase</button>
            </div>
        </div>

        <div class="service-card">
            <h3>Integration Test Results</h3>
            <div id="test-results">No tests run yet</div>
        </div>

        <div class="service-card">
            <h3>Activity Log</h3>
            <div id="activity-log" class="log">System initialized...
</div>
        </div>
    </div>

    <script>
        // WebSocket connection for real-time updates
        let ws = null;

        function connectWebSocket() {
            try {
                ws = new WebSocket('ws://localhost:8085/ws');
                ws.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    handleWebSocketMessage(data);
                };
                ws.onopen = function() {
                    log('WebSocket connected');
                    // Subscribe to relevant channels
                    ws.send(JSON.stringify({type: 'subscribe', channel: 'agent_forge_phases'}));
                    ws.send(JSON.stringify({type: 'subscribe', channel: 'system_metrics'}));
                };
                ws.onclose = function() {
                    log('WebSocket disconnected, reconnecting...');
                    setTimeout(connectWebSocket, 5000);
                };
            } catch (e) {
                log('WebSocket connection failed: ' + e.message);
                setTimeout(connectWebSocket, 5000);
            }
        }

        function handleWebSocketMessage(data) {
            if (data.type === 'phase_update') {
                log(`Phase Update: ${data.phase_name} - ${data.message} (${Math.round(data.progress * 100)}%)`);
            } else if (data.type === 'system_metrics') {
                updateSystemMetrics(data.metrics);
            }
        }

        function log(message) {
            const logEl = document.getElementById('activity-log');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}
`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        async function refreshStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                updateServiceStatus(data);
                log('Service status refreshed');
            } catch (e) {
                log('Failed to refresh status: ' + e.message);
            }
        }

        async function runTests() {
            try {
                log('Running integration tests...');
                const response = await fetch('/api/integration-tests');
                const data = await response.json();
                updateTestResults(data);
                log(`Tests completed: ${data.summary.passed}/${data.summary.total} passed`);
            } catch (e) {
                log('Failed to run tests: ' + e.message);
            }
        }

        async function startCognatePhase() {
            try {
                log('Starting Cognate phase...');
                const response = await fetch('http://localhost:8083/phases/cognate/start', {method: 'POST'});
                const data = await response.json();
                log(`Cognate phase started: ${data.message}`);
            } catch (e) {
                log('Failed to start Cognate phase: ' + e.message);
            }
        }

        function updateServiceStatus(data) {
            const statusEl = document.getElementById('service-status');
            let html = `<p><strong>Overall:</strong> <span class="status-${data.overall_health}">${data.overall_health}</span></p>`;

            for (const [service, info] of Object.entries(data.services)) {
                html += `<p><strong>${service}:</strong> <span class="status-${info.status}">${info.status}</span> (Port ${info.port})</p>`;
            }

            statusEl.innerHTML = html;
        }

        function updateSystemMetrics(metrics) {
            const metricsEl = document.getElementById('system-metrics');
            let html = '';

            for (const [key, value] of Object.entries(metrics)) {
                const displayKey = key.replace('_', ' ').toUpperCase();
                const displayValue = typeof value === 'number' ? value.toFixed(1) : value;
                html += `<div class="metric"><strong>${displayKey}</strong><br>${displayValue}</div>`;
            }

            metricsEl.innerHTML = html;
        }

        function updateTestResults(data) {
            const resultsEl = document.getElementById('test-results');
            let html = `<h4>Test Summary: ${data.summary.passed}/${data.summary.total} passed</h4>`;

            for (const test of data.tests) {
                const status = test.passed ? '‚úÖ' : '‚ùå';
                html += `<p>${status} <strong>${test.name}:</strong> ${test.message}</p>`;
            }

            resultsEl.innerHTML = html;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            refreshStatus();
            connectWebSocket();

            // Refresh status every 30 seconds
            setInterval(refreshStatus, 30000);
        });
    </script>
</body>
</html>
